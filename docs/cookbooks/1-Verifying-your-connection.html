

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Verifying your connection &mdash; GBQ Lab - reusable notebooks for research data analytics - powered by Dimensions on Google BigQuery</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/custom.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Publication queries" href="2-Publications-queries.html" />
    <link rel="prev" title="Welcome to the Dimensions BigQuery Lab!" href="../index.html" />
    

   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149959808-1"></script>
   <!-- <script src="_static/js/custom.js"></script> -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Dimensions GBQ LAB
          

          
            
            <img src="../_static/dimensions-logo@2x.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          

   <p class="">
      <h3 id="cookbooks_title">GBQ COOKBOOKS</h3>
   </p>


   
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Verifying your connection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Connection-methods">Connection methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Option-1:-using-Google-Colaboratory-and-your-personal-credentials">Option 1: using Google Colaboratory and your personal credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Option-2:-using-a-local-Jupyter-and-your-personal-credentials">Option 2: using a local Jupyter and your personal credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Option-3:-using-a-local-Jupyter-and-a-service-account">Option 3: using a local Jupyter and a service account</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Running-queries">Running queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Advanced:-BigQuery-magic-command-and-dynamic-parameters">Advanced: BigQuery magic command and dynamic parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2-Publications-queries.html">Publication queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#1.-Top-publications-by-Altmetric-score-and-research-organization">1. Top publications by Altmetric score and research organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#1.-Working-with-Publications-dates">1. Working with Publications dates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#Comparing-date-fields">Comparing date fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#Number-of-publications-added-to-Dimensions-by-month">Number of publications added to Dimensions by month</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#2.-Working-with-NESTED-fields">2. Working with NESTED fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#3.-Generate-a-list-of-publication-authors-by-flattening/concatenating-nested-data">3. Generate a list of publication authors by flattening/concatenating nested data</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#4.-Generate-a-list-of-publication-categories-by-flattening/concatenating-nested-data">4. Generate a list of publication categories by flattening/concatenating nested data</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#5.-Number-of-publications-per-SDG-category">5. Number of publications per SDG category</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#6.-Publications-count-per-FoR-category,-total-and-percentage-against-total">6. Publications count per FoR category, total and percentage against total</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#7.-Finding-Journals-using-string-matching">7. Finding Journals using string matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#8.-Finding-articles-matching-a-specific-affiliation-string">8. Finding articles matching a specific affiliation string</a><ul>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#8.1-Variant:-get-unique-publication-records-with-affiliation-count">8.1 Variant: get unique publication records with affiliation count</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#9.-Select-publications-matching-selected-concepts">9. Select publications matching selected concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#10.-Count-of-corresponding-authors-by-publisher">10. Count of corresponding authors by publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#11.-Counting-new-vs-recurring-authors,-for-a-specific-journal">11. Counting new vs recurring authors, for a specific journal</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#12.-Funding-by-journal">12. Funding by journal</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#13.-Citations-queries">13. Citations queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#13.1-Top-N-publications-by-citations-percentile">13.1 Top N publications by citations percentile</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#13.2-Citations-by-journal,-for-a-specific-publisher">13.2 Citations by journal, for a specific publisher</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#13.3-One-degree-citation-network-for-a-single-publication">13.3 One-degree citation network for a single publication</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#13.4-Incoming-citations-for-a-journal">13.4 Incoming citations for a journal</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Publications-queries.html#13.5-Outgoing-citations-to-a-journal">13.5 Outgoing citations to a journal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-Publications-queries.html#14.-Extracting-complex-publications-records">14. Extracting complex publications records</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3-Using-the-API-with-GBQ.html">From the DSL API to Google BigQuery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#Example:-profiling-researchers-linked-to-a-topic">Example: profiling researchers linked to a topic</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#1.-Connecting-to-the-DSL-API">1. Connecting to the DSL API</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#2.-Exporting-DSL-results-to-GBQ">2. Exporting DSL results to GBQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#3.-Querying-your-new-dataset-using-a-JOIN-on-Dimensions">3. Querying your new dataset using a JOIN on Dimensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Using-the-API-with-GBQ.html#4.-Using-GBQ-to-generate-researcher-statistics">4. Using GBQ to generate researcher statistics</a></li>
</ul>
</li>
</ul>

            
          


   <div id="sidebar_github" style="margin-top: 12px;">
   <h3>Github Source</h3>

      <div style="margin: 10px 20px;">
      
         <iframe src="https://ghbtns.com/github-btn.html?user=digital-science&repo=dimensions-gbq-lab&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>

         <iframe src="https://ghbtns.com/github-btn.html?user=digital-science&repo=dimensions-gbq-lab&type=fork&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe> 
      
      </div>

   </div>


        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dimensions GBQ LAB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    

    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<script src='http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js'></script>
<script>require=requirejs;</script><a class="reference external image-reference" href="https://colab.research.google.com/github/digital-science/dimensions-gbq-lab/blob/master/cookbooks/1-Verifying-your-connection.ipynb"><img alt="../_images/badge-colab.svg" src="../_images/badge-colab.svg" /></a>
<a class="reference external image-reference" href="https://github.com/digital-science/dimensions-gbq-lab/blob/master/cookbooks/1-Verifying-your-connection.ipynb"><img alt="../_images/badge-github-custom.svg" src="../_images/badge-github-custom.svg" /></a>
<hr class="docutils" />
<div class="section" id="Verifying-your-connection">
<h1>Verifying your connection<a class="headerlink" href="#Verifying-your-connection" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we will show how to connect to the Dimensions on Google BigQuery using Python, so that we can then run a few sample queries. In order to run this tutorial, please ensure that:</p>
<ul class="simple">
<li><p>You have a valid Dimensions on Google BigQuery <a class="reference external" href="https://www.dimensions.ai/products/bigquery/">account</a></p></li>
<li><p>You have configured your Google Cloud Platform environment (see the <a class="reference external" href="https://docs.dimensions.ai/bigquery/gcp-setup.html#">official docs</a> on how to do that)</p></li>
</ul>
<div class="section" id="Connection-methods">
<h2>Connection methods<a class="headerlink" href="#Connection-methods" title="Permalink to this headline">¶</a></h2>
<p>There are a few options available:</p>
<ol class="arabic simple">
<li><p><strong>Use Google Colaboratory and your personal credentials.</strong> This option is the simplest of all, as it doesn’t require you to install anything on your computer. It is normally ok for small to mid-sized projects that can live in the cloud.</p></li>
<li><p><strong>Use a local Jupyter environment and your personal credentials.</strong> This option requires you to install the Google Cloud SDK in order to authenticate. It is the best option if you want to work locally and/or have other Python libraries or services that you need to access.</p></li>
<li><p><strong>Use a local Jupyter environment and a service account.</strong> This option is really a variance on the option 2, for those users that must use a service account.</p></li>
</ol>
<p>NOTE All of these options require you to first set up a <a class="reference external" href="https://docs.dimensions.ai/bigquery/gcp-setup.html#projects">GCP project</a> (as you haven’t done it already) and provide your project ID. E.g.:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">MY_PROJECT_ID</span> <span class="o">=</span> <span class="s2">&quot;my-cool-gbq-project&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Option-1:-using-Google-Colaboratory-and-your-personal-credentials">
<h3>Option 1: using Google Colaboratory and your personal credentials<a class="headerlink" href="#Option-1:-using-Google-Colaboratory-and-your-personal-credentials" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://colab.research.google.com/">Google Colaboratory</a> is a free cloud-based Jupyter environment from Google. This option provides an easy service allowing you to get started with notebooks.</p>
<p>Using your Google Account you can create notebooks, execute BigQuery queries and share these with other Google Accounts quickly and easily.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># authentication happens via your browser</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="n">auth</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Authenticated&#39;</span><span class="p">)</span>

<span class="n">MY_PROJECT_ID</span> <span class="o">=</span> <span class="s2">&quot;my-cool-gbq-project&quot;</span>
<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">MY_PROJECT_ID</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Option-2:-using-a-local-Jupyter-and-your-personal-credentials">
<h3>Option 2: using a local Jupyter and your personal credentials<a class="headerlink" href="#Option-2:-using-a-local-Jupyter-and-your-personal-credentials" title="Permalink to this headline">¶</a></h3>
<p>A Google Account represents a developer, an administrator, or any other person who interacts with Google Cloud. This is normally the Google account one has used to get access to the Dimensions on BigQuery product.</p>
<p>In order to configure programmatic access for local development, the easiest way is to authenticate using the <a class="reference external" href="https://googleapis.dev/python/google-api-core/latest/auth.html">Google Cloud SDK</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gcloud auth application-default login
</pre></div>
</div>
<p>Note: the command above should be run from a Terminal or console. This will generate a JSON file that is used as the default application credentials for the account that was selected in the above login process. When using the default Client for each Google provided package (such as BigQuery) they should automatically authenticate using these default credentials.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># install python client library</span>
<span class="o">!</span>pip install google-cloud-bigquery -U --quiet
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>

<span class="n">MY_PROJECT_ID</span> <span class="o">=</span> <span class="s2">&quot;my-cool-gbq-project&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">MY_PROJECT_ID</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Option-3:-using-a-local-Jupyter-and-a-service-account">
<h3>Option 3: using a local Jupyter and a service account<a class="headerlink" href="#Option-3:-using-a-local-Jupyter-and-a-service-account" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference external" href="https://cloud.google.com/iam/docs/service-accounts">service account</a> is a special kind of account used by an application or a virtual machine (VM) instance, not a person.</p>
<p>Each service account is associated with two sets of public/private RSA key pairs that are used to authenticate to Google: Google-managed keys, and user-managed keys.</p>
<p>When using a service account you’d just have to point your client object to the a key file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>
<span class="n">credentials_file</span> <span class="o">=</span> <span class="s1">&#39;my-awesome-gbq-project-47616836.json&#39;</span>

<span class="n">MY_PROJECT_ID</span> <span class="o">=</span> <span class="s2">&quot;my-cool-gbq-project&quot;</span>

<span class="c1"># Explicitly use service account credentials by specifying the private key file</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="o">.</span><span class="n">from_service_account_json</span><span class="p">(</span><span class="n">credentials_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Running-queries">
<h2>Running queries<a class="headerlink" href="#Running-queries" title="Permalink to this headline">¶</a></h2>
<p>Once the connection is set up, all you have to do is to type in a SQL query and run it using the <code class="docutils literal notranslate"><span class="pre">client</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># Query: Top publications from Oxford univ. by Altmetric Score in 2020</span>

<span class="n">query_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT</span>
<span class="s2">    id,</span>
<span class="s2">    title.preferred as title,</span>
<span class="s2">    ARRAY_LENGTH(authors) as authors_count,</span>
<span class="s2">    CAST(altmetrics.score as INT64) as altmetric_score</span>
<span class="s2">FROM</span>
<span class="s2">    `dimensions-ai.data_analytics.publications`</span>
<span class="s2">WHERE</span>
<span class="s2">    year = 2020 AND &#39;grid.4991.5&#39; in UNNEST(research_orgs)</span>
<span class="s2">ORDER BY</span>
<span class="s2">    altmetric_score DESC</span>
<span class="s2">LIMIT 5&quot;&quot;&quot;</span>

<span class="c1"># 1 - main syntax</span>

<span class="n">query_job</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">query_job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Waits for job to complete.</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; </span><span class="si">{}</span><span class="s2"> : </span><span class="si">{}</span><span class="se">\n\t</span><span class="s2">Authors: </span><span class="si">{}</span><span class="se">\n\t</span><span class="s2">Altmetric Score: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">authors_count</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">altmetric_score</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt; pub.1129493369 : Safety and immunogenicity of the ChAdOx1 nCoV-19 vaccine against SARS-CoV-2: a preliminary report of a phase 1/2, single-blind, randomised controlled trial
        Authors: 366
        Altmetric Score: 15451
&gt; pub.1130340155 : Two metres or one: what is the evidence for physical distancing in covid-19?
        Authors: 6
        Altmetric Score: 15125
&gt; pub.1127239818 : Remdesivir in adults with severe COVID-19: a randomised, double-blind, placebo-controlled, multicentre trial
        Authors: 46
        Altmetric Score: 12675
&gt; pub.1131721397 : Scientific consensus on the COVID-19 pandemic: we need to act now
        Authors: 31
        Altmetric Score: 10192
&gt; pub.1126016857 : Quantifying SARS-CoV-2 transmission suggests epidemic control with digital contact tracing
        Authors: 9
        Altmetric Score: 8320
</pre></div></div>
</div>
<p>An slighly alternative syntax is also possible</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 2 - omit calling result()</span>

<span class="n">query_job</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">query_job</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Row((&#39;pub.1129493369&#39;, &#39;Safety and immunogenicity of the ChAdOx1 nCoV-19 vaccine against SARS-CoV-2: a preliminary report of a phase 1/2, single-blind, randomised controlled trial&#39;, 366, 15451), {&#39;id&#39;: 0, &#39;title&#39;: 1, &#39;authors_count&#39;: 2, &#39;altmetric_score&#39;: 3})
Row((&#39;pub.1130340155&#39;, &#39;Two metres or one: what is the evidence for physical distancing in covid-19?&#39;, 6, 15125), {&#39;id&#39;: 0, &#39;title&#39;: 1, &#39;authors_count&#39;: 2, &#39;altmetric_score&#39;: 3})
Row((&#39;pub.1127239818&#39;, &#39;Remdesivir in adults with severe COVID-19: a randomised, double-blind, placebo-controlled, multicentre trial&#39;, 46, 12675), {&#39;id&#39;: 0, &#39;title&#39;: 1, &#39;authors_count&#39;: 2, &#39;altmetric_score&#39;: 3})
Row((&#39;pub.1131721397&#39;, &#39;Scientific consensus on the COVID-19 pandemic: we need to act now&#39;, 31, 10192), {&#39;id&#39;: 0, &#39;title&#39;: 1, &#39;authors_count&#39;: 2, &#39;altmetric_score&#39;: 3})
Row((&#39;pub.1126016857&#39;, &#39;Quantifying SARS-CoV-2 transmission suggests epidemic control with digital contact tracing&#39;, 9, 8320), {&#39;id&#39;: 0, &#39;title&#39;: 1, &#39;authors_count&#39;: 2, &#39;altmetric_score&#39;: 3})
</pre></div></div>
</div>
<p>Another quite handy feature is to transform data direclty into <a class="reference external" href="https://pandas.pydata.org/pandas-docs/">Pandas dataframes</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 3 - return a dataframe</span>

<span class="n">query_job</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_1</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">query_job</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>authors_count</th>
      <th>altmetric_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>pub.1129493369</td>
      <td>Safety and immunogenicity of the ChAdOx1 nCoV-...</td>
      <td>366</td>
      <td>15451</td>
    </tr>
    <tr>
      <th>1</th>
      <td>pub.1130340155</td>
      <td>Two metres or one: what is the evidence for ph...</td>
      <td>6</td>
      <td>15125</td>
    </tr>
    <tr>
      <th>2</th>
      <td>pub.1127239818</td>
      <td>Remdesivir in adults with severe COVID-19: a r...</td>
      <td>46</td>
      <td>12675</td>
    </tr>
    <tr>
      <th>3</th>
      <td>pub.1131721397</td>
      <td>Scientific consensus on the COVID-19 pandemic:...</td>
      <td>31</td>
      <td>10192</td>
    </tr>
    <tr>
      <th>4</th>
      <td>pub.1126016857</td>
      <td>Quantifying SARS-CoV-2 transmission suggests e...</td>
      <td>9</td>
      <td>8320</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="Advanced:-BigQuery-magic-command-and-dynamic-parameters">
<h3>Advanced: BigQuery magic command and dynamic parameters<a class="headerlink" href="#Advanced:-BigQuery-magic-command-and-dynamic-parameters" title="Permalink to this headline">¶</a></h3>
<p>The GBQ library comes with a <a class="reference external" href="https://googleapis.dev/python/bigquery/latest/magics.html">magic command</a> that is essentially a nice shortcut method for running queries.</p>
<p>This extensions needs to be loaded sepately e.g.:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> google.cloud.bigquery
</pre></div>
</div>
</div>
<p>We can then set up a couple of query parameters for the query itself, as well as the usual project ID value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">project_id</span> <span class="o">=</span> <span class="n">MY_PROJECT_ID</span>
<span class="n">bq_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bq_params</span><span class="p">[</span><span class="s2">&quot;journal_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;jour.1115214&quot;</span>
</pre></div>
</div>
</div>
<p>Finally we can query by starting a cell with the command <code class="docutils literal notranslate"><span class="pre">%%bigquery</span> <span class="pre">...</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">bigquery</span> --params $bq_params --project $project_id

# Publications per year for Nature Biotechnology

SELECT
    count(*) as pubs, year, journal.title
FROM
    `dimensions-ai.data_analytics.publications`
WHERE
    year &gt;= 2010
    AND journal.id = @journal_id
GROUP BY
    year, journal.title
ORDER BY
    year DESC

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Query complete after 0.02s: 100%|██████████| 1/1 [00:00&lt;00:00, 699.28query/s]
Downloading: 100%|██████████| 11/11 [00:02&lt;00:00,  4.31rows/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pubs</th>
      <th>year</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>438</td>
      <td>2020</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>1</th>
      <td>386</td>
      <td>2019</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>2</th>
      <td>374</td>
      <td>2018</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>3</th>
      <td>380</td>
      <td>2017</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>4</th>
      <td>436</td>
      <td>2016</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>5</th>
      <td>467</td>
      <td>2015</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>6</th>
      <td>475</td>
      <td>2014</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>7</th>
      <td>462</td>
      <td>2013</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>8</th>
      <td>507</td>
      <td>2012</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>9</th>
      <td>459</td>
      <td>2011</td>
      <td>Nature Biotechnology</td>
    </tr>
    <tr>
      <th>10</th>
      <td>486</td>
      <td>2010</td>
      <td>Nature Biotechnology</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#Troubleshooting" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Query fails wit <code class="docutils literal notranslate"><span class="pre">to_dataframe()</span> <span class="pre">ArrowNotImplementedError</span></code></p>
<ul>
<li><p>Try reinstalling pyarrow ie <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pyarrow</span> <span class="pre">-U</span></code></p></li>
</ul>
</li>
<li><p>Query fails with <code class="docutils literal notranslate"><span class="pre">AttributeError:</span> <span class="pre">'NoneType'</span> <span class="pre">object</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">attribute</span> <span class="pre">'transport'</span></code></p>
<ul>
<li><p>Try <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">google-cloud-bigquery-storage</span> <span class="pre">-U</span></code> and restarting the notebook</p></li>
</ul>
</li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="https://www.dimensions.ai/products/bigquery/">Dimensions on BigQuery</a> allows to carry out sophisticated research data analytics tasks like the ones described on this website. Check out also the associated <a class="reference external" href="https://github.com/digital-science/dimensions-gbq-lab">Github repository</a> for examples, the source code of these tutorials and much more.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    <p>© Copyright 2020 Digital Science & Research Solutions, Inc. All Rights Reserved | <a href="https://www.dimensions.ai/">About us</a> · <a href="https://www.dimensions.ai/privacy/">Privacy policy</a> · <a href="https://www.dimensions.ai/website-terms/">Legal terms</a></p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    

    <!-- Adds target=_blank to external links -->

  <script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>
  


</body>
</html>