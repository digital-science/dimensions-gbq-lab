
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Identify a funder's grants and publications - Dimensions BigQuery Lab</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
  



  
  



  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-149959808-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#identify-a-funders-grants-and-publications" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Dimensions BigQuery Lab" class="md-header__button md-logo" aria-label="Dimensions BigQuery Lab" data-md-component="logo">
      
  <img src="../../assets/img/apple-touch-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dimensions BigQuery Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Identify a funder's grants and publications
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Dimensions BigQuery Lab" class="md-nav__button md-logo" aria-label="Dimensions BigQuery Lab" data-md-component="logo">
      
  <img src="../../assets/img/apple-touch-icon.png" alt="logo">

    </a>
    Dimensions BigQuery Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        About Tutorials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-connection/" class="md-nav__link">
        Verifying your connection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03-dates/" class="md-nav__link">
        Working with dates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04-nested/" class="md-nav__link">
        Working with nested and repeated fields
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02-dsl/" class="md-nav__link">
        From the DSL API to Google BigQuery
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../05-topic_clusters/" class="md-nav__link">
        Basic Topic Clustering using TensorFlow and BigQuery ML
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Identify a funder's grants and publications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Identify a funder's grants and publications
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    Use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method" class="md-nav__link">
    Method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-this-notebook" class="md-nav__link">
    Using this notebook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-connect-to-dimensions" class="md-nav__link">
    1. Connect to Dimensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-find-funders-unique-grid-id" class="md-nav__link">
    2. Find funder's unique GRID ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-generate-list-of-grants-and-publications-identifiers" class="md-nav__link">
    3. Generate list of grants and publications identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-optional-export-list-of-grants-and-resulting-publications-to-excel" class="md-nav__link">
    4. (OPTIONAL) Export list of grants and resulting publications to excel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-summary-table-of-number-of-grants-and-publications-in-total-and-by-year" class="md-nav__link">
    5. Summary table of number of grants and publications in total and by year
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-bar-graph-showing-number-of-grants-that-have-yielded-one-or-more-publications-by-year" class="md-nav__link">
    6. Bar graph showing number of grants that have yielded one or more publications by year
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../07-retrieve_patents/" class="md-nav__link">
        Retrieve patents linked to a set of grants
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Collections
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Collections" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Collections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../collections/" class="md-nav__link">
        About Collections
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../collections/01-publications/" class="md-nav__link">
        Publications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../collections/02-citations/" class="md-nav__link">
        Citations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../collections/03-authors/" class="md-nav__link">
        Authors
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../collections/04-funding/" class="md-nav__link">
        Funding & Grants
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Queries
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Queries" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Queries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/" class="md-nav__link">
        About Queries
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/01/" class="md-nav__link">
        1. Number of publications added to Dimensions each month
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/02/" class="md-nav__link">
        2. Number of Publications by Type
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/03/" class="md-nav__link">
        3. Generate a list of publication authors by flattening/concatenating nested data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/04/" class="md-nav__link">
        4. Generate a list of publication categories by flattening/concatenating nested data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/05/" class="md-nav__link">
        5. Number of publications per SDG category
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/06/" class="md-nav__link">
        6. Publications count per FoR category, total and percentage against total
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/07/" class="md-nav__link">
        7. Finding Journals using string matching
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/08/" class="md-nav__link">
        8. Finding articles matching a specific affiliation string
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/09/" class="md-nav__link">
        9. Top publications by Altmetric score and research organization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/10/" class="md-nav__link">
        10. Select publications matching selected concepts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/11/" class="md-nav__link">
        11. Count of corresponding authors by publisher
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/12/" class="md-nav__link">
        12. Counting new vs recurring authors, for a specific journal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/13/" class="md-nav__link">
        13. Funding by journal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/14/" class="md-nav__link">
        14. Extracting complex publications records
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/15/" class="md-nav__link">
        15. Top N publications by citations percentile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/16/" class="md-nav__link">
        16. Citations by journal, for a specific publisher
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/17/" class="md-nav__link">
        17. One-degree citation network for a single publication
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/18/" class="md-nav__link">
        18. Incoming citations for a journal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/19/" class="md-nav__link">
        19. Outgoing citations from a journal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/20/" class="md-nav__link">
        20. International collaboration of an organisation in a field
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/21/" class="md-nav__link">
        21. International collaboration rate of individuals, with context
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/22/" class="md-nav__link">
        22. Incoming citations for a single publication, by journal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/23/" class="md-nav__link">
        23. Citing authors by country
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/24/" class="md-nav__link">
        24. Organizations and sub-organizations
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/25/" class="md-nav__link">
        25. Grants for an organization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/26/" class="md-nav__link">
        26. Field Citation Ratio (FCR) median average
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../queries/27/" class="md-nav__link">
        27. List of corresponding authors
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-case" class="md-nav__link">
    Use case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method" class="md-nav__link">
    Method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-this-notebook" class="md-nav__link">
    Using this notebook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-connect-to-dimensions" class="md-nav__link">
    1. Connect to Dimensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-find-funders-unique-grid-id" class="md-nav__link">
    2. Find funder's unique GRID ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-generate-list-of-grants-and-publications-identifiers" class="md-nav__link">
    3. Generate list of grants and publications identifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-optional-export-list-of-grants-and-resulting-publications-to-excel" class="md-nav__link">
    4. (OPTIONAL) Export list of grants and resulting publications to excel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-summary-table-of-number-of-grants-and-publications-in-total-and-by-year" class="md-nav__link">
    5. Summary table of number of grants and publications in total and by year
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-bar-graph-showing-number-of-grants-that-have-yielded-one-or-more-publications-by-year" class="md-nav__link">
    6. Bar graph showing number of grants that have yielded one or more publications by year
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="identify-a-funders-grants-and-publications">Identify a funder's grants and publications</h1>
<h3 id="use-case">Use case</h3>
<p>How many grants have resulted in publications?</p>
<p>i. Enables identification of a funder's grants and resulting publications.</p>
<p>ii. Prepare summary table of grants and publications per year and in total and a bar graph showing number of grants with and without publications by year.</p>
<h3 id="method">Method</h3>
<p>This notebook retrieves grants and publication data from Dimensions the world's largest linked research information dataset. For more about Dimensions visit - https://www.dimensions.ai/</p>
<p>To complete this analysis the following steps are taken:</p>
<ol>
<li>Connect to the Dimensions database.</li>
<li>Find funder's unique GRID ID. The Global Research Identifier Database (GRID) is a database of research-related organisations each with a unique and persistent identifier. For more about GRID visit - https://grid.ac/.</li>
<li>Generate list of grants and resulting publications.</li>
<li>(OPTIONAL) Export list of grants and resulting publications to excel.</li>
<li>Summary table showing number of grants and publications in total and by year.</li>
<li>Graph showing number of grants that have yielded one or more publications by year.</li>
</ol>
<h3 id="using-this-notebook">Using this notebook</h3>
<p>Before running some cells you will have to fill in information about the funder and year range. When required instructions are set out in info boxes.</p>
<p>This notebook assumes installation of python packages pandas and plotly.</p>
<h3 id="1-connect-to-dimensions">1. Connect to Dimensions</h3>
<p>You will need to be authenticated to run these queries—see the <a href="../01-connection/">"Verifying your connection</a> tutorial for options.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>

<span class="n">GBQ_PROJECT_ID</span> <span class="o">=</span> <span class="s1">&#39;ds-gov-funder-gbq&#39;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">GBQ_PROJECT_ID</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-find-funders-unique-grid-id">2. Find funder's unique GRID ID</h3>
<p>To identify funder's grants we need the funder's unique GRID ID. The following cell searches on the funders names and returns the associated GRID ID(s).</p>
<div class="admonition example">
<p class="admonition-title">Instructions</p>
<ol>
<li>Before running the code in the following cell input funder's name</li>
<li>Funder's name might return multiple GRID IDs, note all relevant GRID IDs as they are needed for the next step.</li>
</ol>
</div>
<p>If no GRID IDs are returned, try searching different name variants for the funder. Avoid acronyms.</p>
<div class="highlight"><pre><span></span><code><span class="n">funder_name</span> <span class="o">=</span> <span class="s1">&#39;Wellcome Trust&#39;</span> <span class="c1"># Input funder name here</span>
<span class="n">funder_name</span> <span class="o">=</span> <span class="n">funder_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    select</span>
<span class="s2">        id as grid_id</span>
<span class="s2">        , name</span>
<span class="s2">    from `dimensions-ai.data_analytics.grid`</span>
<span class="s2">    where lower(name) like &#39;%</span><span class="si">{</span><span class="n">funder_name</span><span class="si">}</span><span class="s2">%&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">funder</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_gbq</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">funder</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-generate-list-of-grants-and-publications-identifiers">3. Generate list of grants and publications identifiers</h3>
<p>The following cell generates a table of funders grants and any resulting publications for grants started in a defined time period. Only the first five rows of the table will be shown in this notebook, however the whole table can be exported to excel in the following step.</p>
<p>Table columns:</p>
<ul>
<li><code>dimensions_grant_id</code> - Unique identifier for grant in Dimensions</li>
<li><code>grant_start_year</code> - Year the grant started</li>
<li><code>grant_number</code> - Grant number used by funder</li>
<li><code>dimensions_publication_id</code> - Unique identifier for publications in Dimensions</li>
<li><code>doi</code> - Digital Object Identifier</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Instructions</p>
<p>Before running the code in the following cell, where indicated:</p>
<ol>
<li>input funders GRID ID between <code>('')</code> e.g. <code>('grid.52788.30')</code>. If funder has two or more GRID IDs then list within brackets separated by commas e.g. <code>('grid.453157.1', 'grid.453157.1')</code>.</li>
<li>Update year range, note that we can only look at full years and cannot be filtered by month or day.</li>
</ol>
</div>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">with pubs as</span>
<span class="s2">  (select id, doi from `dimensions-ai.data_analytics.publications`)</span>
<span class="s2">, grants as</span>
<span class="s2">  (</span>
<span class="s2">  select</span>
<span class="s2">    id as dimensions_grant_id</span>
<span class="s2">    , start_year as grant_start_year</span>
<span class="s2">    , grant_number</span>
<span class="s2">    , pub_id as dimensions_publication_id</span>
<span class="s2">  from `dimensions-ai.data_analytics.grants` g left join unnest(g.resulting_publication_ids) as pub_id</span>
<span class="s2">   where funder_org in (&#39;grid.52788.30&#39;)  -- ADD GRID ID HERE BETWEEN &#39; &#39; e.g. &#39;grid.54679.3&#39;</span>
<span class="s2">      and start_year between 2011 and 2015 -- UPDATE YEAR RANGE</span>
<span class="s2">    )</span>
<span class="s2">Select</span>
<span class="s2">  grants.*</span>
<span class="s2">  , pubs.doi</span>
<span class="s2">from grants</span>
<span class="s2">  left join pubs</span>
<span class="s2">    on pubs.id = grants.dimensions_publication_id</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">grants</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_gbq</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">grants</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h3 id="4-optional-export-list-of-grants-and-resulting-publications-to-excel">4. (OPTIONAL) Export list of grants and resulting publications to excel</h3>
<p>The following cell creates new excel file of grants and resulting publications as output from previous cell. The new file will appear in the same location as this notebook is saved.</p>
<div class="admonition example">
<p class="admonition-title">Instructions</p>
<p>Before running code the code in the following cell replace <code>FILE_NAME</code> with new file name.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># Creates new excel file.</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;FILE_NAME.xlsx&#39;</span><span class="p">,</span>  <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>

<span class="n">grants</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;grants_pubs&#39;</span><span class="p">)</span>

<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<h3 id="5-summary-table-of-number-of-grants-and-publications-in-total-and-by-year">5. Summary table of number of grants and publications in total and by year</h3>
<p>The following cell creates a table with columns, for all years and per year:</p>
<ul>
<li><code>grant_start_year</code> - first year of the grant</li>
<li><code>grants</code> - number of grants awarded by funder</li>
<li><code>publications</code> - number of publications resulting from awards by funder</li>
<li><code>grants_without_publications</code> - number of grants that have not resulted in a publication</li>
<li><code>perc_without_publications</code> - percentage of grants that have not resulted in a publication</li>
<li><code>avg_publications_per_grants</code> - average (mean) number of publications per grant</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Instructions</p>
<p>Before running code the code in the following cell, where indicated:</p>
<ol>
<li>input funders GRID ID between <code>('')</code> e.g. <code>('grid.52788.30')</code>. If funder has two or more GRID IDs then list within brackets separated by commas e.g. <code>('grid.453157.1', 'grid.453157.1')</code>.</li>
<li>Update year range</li>
</ol>
</div>
<div class="highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">with grant_pub_map as</span>
<span class="s2">  (</span>
<span class="s2">  select</span>
<span class="s2">    id</span>
<span class="s2">    , start_year</span>
<span class="s2">   , pub_id  -- is this the best way of finding publications? or search for grant or</span>
<span class="s2">  from `dimensions-ai.data_analytics.grants` g left join unnest(g.resulting_publication_ids) as pub_id</span>
<span class="s2">    where funder_org = &#39;grid.52788.30&#39;  -- ADD GRID IDs HERE BETWEEN &#39; &#39; e.g. &#39;grid.52788.30&#39;</span>
<span class="s2">      and start_year between 2011 and 2015 -- UPDATE YEAR RANGE</span>
<span class="s2">  )</span>
<span class="s2">select</span>
<span class="s2">  &#39;All years&#39; as grant_start_year</span>
<span class="s2">  , count(distinct id) as grants</span>
<span class="s2">  , count(pub_id) as publications</span>
<span class="s2">  , countif(pub_id is null) as grants_without_publications</span>
<span class="s2">  , round(((countif(pub_id is null)/count(distinct id))*100), 2) as perc_without_publications</span>
<span class="s2">  , round((count(pub_id)/(count(distinct id) )),2) as avg_publications_per_grants</span>
<span class="s2">from grant_pub_map</span>
<span class="s2"> union all</span>
<span class="s2">select</span>
<span class="s2">  cast(start_year as string) as grant_start_year</span>
<span class="s2">  , count(distinct id) as grants</span>
<span class="s2">  , count(pub_id) as publications</span>
<span class="s2">  , countif(pub_id is null) as grants_without_publications</span>
<span class="s2">  , round(((countif(pub_id is null)/count(distinct id))*100), 2) as perc_without_publications</span>
<span class="s2">  , round((count(pub_id)/(count(distinct id) )),2) as avg_publications_per_grants</span>
<span class="s2">from grant_pub_map</span>
<span class="s2">  group by start_year</span>
<span class="s2">order by 1 desc ;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">grants1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_gbq</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">grants1</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<h3 id="6-bar-graph-showing-number-of-grants-that-have-yielded-one-or-more-publications-by-year">6. Bar graph showing number of grants that have yielded one or more publications by year</h3>
<p>Using the table above the following cell generates a bar graph showing the number of grants with and without publications per year.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Remove first row that counts all grants over all years</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">grants1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Reverse rows so earlist year shown first on bar graph</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Calculate number of grants with publications</span>
<span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;grant_pubs&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;grants&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;grants_without_publications&quot;</span><span class="p">])</span>


<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">grant_start_year</span>

<span class="n">trace1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">x</span><span class="p">,</span>
    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">grant_pubs</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Grants with publications&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;bar&#39;</span>
<span class="p">};</span>
<span class="n">trace2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">x</span><span class="p">,</span>
    <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">grants_without_publications</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;Grants without publications&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;bar&#39;</span>
<span class="p">};</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">trace1</span><span class="p">,</span> <span class="n">trace2</span><span class="p">];</span>
<span class="n">layout</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;xaxis&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="s1">&#39;Year&#39;</span><span class="p">},</span>
    <span class="s1">&#39;yaxis&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="s1">&#39;Number of grants&#39;</span><span class="p">},</span>
    <span class="s1">&#39;barmode&#39;</span> <span class="p">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Grants with and without publications&#39;</span>
<span class="p">};</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">layout</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../05-topic_clusters/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basic Topic Clustering using TensorFlow and BigQuery ML" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Basic Topic Clustering using TensorFlow and BigQuery ML
            </div>
          </div>
        </a>
      
      
        
        <a href="../07-retrieve_patents/" class="md-footer__link md-footer__link--next" aria-label="Next: Retrieve patents linked to a set of grants" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Retrieve patents linked to a set of grants
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>